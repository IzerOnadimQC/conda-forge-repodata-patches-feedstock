# yaml-language-server: $schema=../patch_yaml_model.json
# from this bit of code
# # pyopenssl 22 used in combination with Cryptography 39 breaks with error
# # "AttributeError: module 'lib' has no attribute 'OpenSSL_add_all_algorithms'".
# # We must pin down cryptography to <39
# if (
#     record_name == "pyopenssl" and
#     record["version"] == "22.0.0" and
#     record.get("timestamp", 0) < 1678096271000
# ):
#     _replace_pin("cryptography >=35.0", "cryptography >=35.0,<39", record["depends"], record)
if:
  name: pyopenssl
  version: 22.0.0
  timestamp_lt: 1678096271000
then:
  - replace_depends:
      old: cryptography >=35.0
      new: cryptography >=35.0,<39

---

# The X509_V_FLAG_NOTIFY_POLICY constant was removed from cryptography in version 42.0.0.
# xref: https://github.com/pyca/cryptography/pull/9163
# This constant was used in pyopenssl versions prior to version 23.2.0.
# xref: https://github.com/pyca/pyopenssl/pull/1213
# pyopenssl versions prior to 22.0.0 did not have an upper bound on cryptograpy to exclude newer versions.
# Therefore, pyopenssl less than 23.2.0 is not compatible with cryptography greater than or equal to 42.0.0,
# but there is nothing preventing pyopenssl<22.0.0 being solved with later versions of cryptography.
if:
  name: pyopenssl
  version_lt: 23.2.0
  timestamp_lt: 1733152856000  # Mon 2 Dec 2024 15:20:56 GMT
then:
  - tighten_depends:
      name: cryptography
      upper_bound: 42.0.0
